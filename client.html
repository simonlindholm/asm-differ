<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="?css" rel="stylesheet">
    <script type="text/javascript">
        'use strict';

        function onNewContent() {
            var httpRequest = ASMDW.httpRequest;
            if (httpRequest.readyState == XMLHttpRequest.DONE) {
                if (httpRequest.status == 200) { // OK
                    document.getElementById('content').innerHTML = httpRequest.responseText;
                    if (ASMDW.requestForever) {
                        setTimeout(requestContent, 100);
                    }
                } else if (httpRequest.status == 204) { // No Content
                    if (ASMDW.requestForever) {
                        setTimeout(requestContent, 100);
                    }
                } else {
                    if (window.confirm('Failed to communicate with localhost:8000, close tab?')) {
                        window.close();
                    }
                }
            }
        }

        function requestContent() {
            var httpRequest = new XMLHttpRequest();
            ASMDW.httpRequest = httpRequest;
            httpRequest.onreadystatechange = onNewContent;
            var url = 'http://localhost:8000?diff';
            if (ASMDW.requestCount == 0)
                url += "&nowait";
            httpRequest.open('GET', url);
            httpRequest.send();
            ASMDW.requestCount++;
        }

        function onBodyLoaded() {
            requestContent();
        }

        // asm-differ web
        window.ASMDW = {
            requestCount: 0,
        };
        var url = new URL(window.location);
        ASMDW.requestForever = url.searchParams.get('once') === null;
    </script>
    <style type="text/css">
        body {
            background-color: #34495e;
        }
    </style>
</head>

<body onload="onBodyLoaded()">
    <div id="content"></div>
</body>

</html>